<ui:FluentWindow x:Class="Dorisoy.Meeting.Client.Views.ScreenshotEditorWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
                 Title="截图编辑"
                 Width="900"
                 Height="700"
                 MinWidth="600"
                 MinHeight="500"
                 WindowStartupLocation="CenterScreen"
                 ExtendsContentIntoTitleBar="True">
    
    <ui:FluentWindow.Resources>
        <!-- 工具按钮样式 -->
        <Style x:Key="ToolButtonStyle" TargetType="RadioButton">
            <Setter Property="Width" Value="36"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="Border" 
                                Background="Transparent" 
                                CornerRadius="6"
                                Padding="6">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource SystemAccentColorPrimaryBrush}"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="{DynamicResource ControlFillColorSecondaryBrush}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- 颜色按钮样式 -->
        <Style x:Key="ColorButtonStyle" TargetType="RadioButton">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="RadioButton">
                        <Border x:Name="Border" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="12"
                                BorderThickness="2"
                                BorderBrush="Transparent">
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="Border" Property="BorderBrush" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </ui:FluentWindow.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- 标题栏 -->
        <ui:TitleBar Grid.Row="0" Title="截图编辑"/>
        
        <!-- 工具栏 -->
        <Border Grid.Row="0" Margin="0,32,0,0" Padding="12,8" 
                Background="{DynamicResource ControlFillColorDefaultBrush}">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- 绘图工具 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Border Background="{DynamicResource ControlFillColorSecondaryBrush}" 
                            CornerRadius="8" Padding="4">
                        <StackPanel Orientation="Horizontal">
                            <RadioButton x:Name="BtnSelect" Style="{StaticResource ToolButtonStyle}"
                                         GroupName="Tools" IsChecked="True"
                                         ToolTip="选择" Checked="Tool_Checked">
                                <ui:SymbolIcon Symbol="Cursor20" FontSize="18" Foreground="White"/>
                            </RadioButton>
                            <RadioButton x:Name="BtnPen" Style="{StaticResource ToolButtonStyle}"
                                         GroupName="Tools" ToolTip="画笔" Checked="Tool_Checked">
                                <ui:SymbolIcon Symbol="Pen20" FontSize="18" Foreground="White"/>
                            </RadioButton>
                            <RadioButton x:Name="BtnRectangle" Style="{StaticResource ToolButtonStyle}"
                                         GroupName="Tools" ToolTip="矩形" Checked="Tool_Checked">
                                <ui:SymbolIcon Symbol="Square20" FontSize="18" Foreground="White"/>
                            </RadioButton>
                            <RadioButton x:Name="BtnEllipse" Style="{StaticResource ToolButtonStyle}"
                                         GroupName="Tools" ToolTip="椭圆" Checked="Tool_Checked">
                                <ui:SymbolIcon Symbol="Circle20" FontSize="18" Foreground="White"/>
                            </RadioButton>
                            <RadioButton x:Name="BtnArrow" Style="{StaticResource ToolButtonStyle}"
                                         GroupName="Tools" ToolTip="箭头" Checked="Tool_Checked">
                                <ui:SymbolIcon Symbol="ArrowRight20" FontSize="18" Foreground="White"/>
                            </RadioButton>
                            <RadioButton x:Name="BtnText" Style="{StaticResource ToolButtonStyle}"
                                         GroupName="Tools" ToolTip="文字" Checked="Tool_Checked">
                                <ui:SymbolIcon Symbol="TextT20" FontSize="18" Foreground="White"/>
                            </RadioButton>
                        </StackPanel>
                    </Border>
                    
                    <Rectangle Width="1" Height="28" Fill="{DynamicResource ControlStrokeColorDefaultBrush}" Margin="8,0"/>
                    
                    <!-- 颜色选择 -->
                    <Border Background="{DynamicResource ControlFillColorSecondaryBrush}" 
                            CornerRadius="8" Padding="4">
                        <StackPanel Orientation="Horizontal">
                            <RadioButton x:Name="ColorRed" Style="{StaticResource ColorButtonStyle}"
                                         GroupName="Colors" Background="#FFFF0000" IsChecked="True"
                                         ToolTip="红色" Checked="Color_Checked" Tag="#FFFF0000"/>
                            <RadioButton x:Name="ColorBlue" Style="{StaticResource ColorButtonStyle}"
                                         GroupName="Colors" Background="#FF0078D4"
                                         ToolTip="蓝色" Checked="Color_Checked" Tag="#FF0078D4"/>
                            <RadioButton x:Name="ColorGreen" Style="{StaticResource ColorButtonStyle}"
                                         GroupName="Colors" Background="#FF10893E"
                                         ToolTip="绿色" Checked="Color_Checked" Tag="#FF10893E"/>
                            <RadioButton x:Name="ColorYellow" Style="{StaticResource ColorButtonStyle}"
                                         GroupName="Colors" Background="#FFFFD700"
                                         ToolTip="黄色" Checked="Color_Checked" Tag="#FFFFD700"/>
                            <RadioButton x:Name="ColorBlack" Style="{StaticResource ColorButtonStyle}"
                                         GroupName="Colors" Background="#FF000000"
                                         ToolTip="黑色" Checked="Color_Checked" Tag="#FF000000"/>
                        </StackPanel>
                    </Border>
                    
                    <Rectangle Width="1" Height="28" Fill="{DynamicResource ControlStrokeColorDefaultBrush}" Margin="8,0"/>
                    
                    <!-- 笔触大小 -->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="粗细" VerticalAlignment="Center" Margin="0,0,8,0"
                                   Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                        <Slider x:Name="SliderStrokeWidth" Width="100" Minimum="1" Maximum="10" Value="3"
                                VerticalAlignment="Center" ValueChanged="SliderStrokeWidth_ValueChanged"/>
                    </StackPanel>
                    
                    <Rectangle Width="1" Height="28" Fill="{DynamicResource ControlStrokeColorDefaultBrush}" Margin="8,0"/>
                    
                    <!-- 撤销 -->
                    <ui:Button x:Name="BtnUndo" Width="36" Height="36" CornerRadius="6"
                               ToolTip="撤销 (Ctrl+Z)" Appearance="Transparent"
                               Click="BtnUndo_Click">
                        <ui:SymbolIcon Symbol="ArrowUndo20" FontSize="18"/>
                    </ui:Button>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- 画布区域 -->
        <Border Grid.Row="1" Background="#FF333333" Margin="0">
            <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                <Grid x:Name="CanvasContainer" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="20">
                    <!-- 背景图片 -->
                    <Image x:Name="BackgroundImage" Stretch="None"/>
                    
                    <!-- 绘制层 -->
                    <Canvas x:Name="DrawingCanvas" 
                            Background="Transparent"
                            MouseLeftButtonDown="Canvas_MouseLeftButtonDown"
                            MouseMove="Canvas_MouseMove"
                            MouseLeftButtonUp="Canvas_MouseLeftButtonUp">
                        
                        <!-- 文字输入框 -->
                        <Border x:Name="TextInputContainer"
                                Visibility="Collapsed"
                                Background="White"
                                BorderBrush="{DynamicResource SystemAccentColorPrimaryBrush}"
                                BorderThickness="2"
                                CornerRadius="4"
                                Padding="4,2">
                            <TextBox x:Name="TextInputBox"
                                     MinWidth="80"
                                     MinHeight="24"
                                     FontSize="16"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     KeyDown="TextInputBox_KeyDown"
                                     LostFocus="TextInputBox_LostFocus"/>
                        </Border>
                    </Canvas>
                </Grid>
            </ScrollViewer>
        </Border>
        
        <!-- 底部操作栏 -->
        <Border Grid.Row="2" Background="{DynamicResource ControlFillColorDefaultBrush}" Padding="16,12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <!-- 左侧：提示 -->
                <TextBlock Grid.Column="0" 
                           Text="编辑完成后点击[确定]复制到剪贴板" 
                           VerticalAlignment="Center"
                           Foreground="{DynamicResource TextFillColorSecondaryBrush}"/>
                
                <!-- 右侧：操作按钮 -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <ui:Button x:Name="BtnSave" 
                               Content="保存" 
                               Appearance="Secondary"
                               Icon="{ui:SymbolIcon Save20}"
                               Margin="0,0,10,0"
                               Padding="16,8"
                               Click="BtnSave_Click"/>
                    <ui:Button x:Name="BtnCancel" 
                               Content="取消" 
                               Appearance="Secondary"
                               Icon="{ui:SymbolIcon Dismiss20}"
                               Margin="0,0,10,0"
                               Padding="16,8"
                               Click="BtnCancel_Click"/>
                    <ui:Button x:Name="BtnConfirm" 
                               Content="确定" 
                               Appearance="Primary"
                               Icon="{ui:SymbolIcon Checkmark20}"
                               Padding="16,8"
                               Click="BtnConfirm_Click"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</ui:FluentWindow>
